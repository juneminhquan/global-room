<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedy Delivery Express - Typing Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #1a1a2e;
            color: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .font-game {
            font-family: 'Bungee', cursive;
        }

        .road {
            background: linear-gradient(0deg, #333 0%, #444 50%, #333 100%);
            background-size: 100% 40px;
            position: relative;
            overflow: hidden;
        }

        .road-lines {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(90deg, #fff, #fff 40px, transparent 40px, transparent 80px);
            animation: moveRoad 1s linear infinite;
        }

        @keyframes moveRoad {
            from { transform: translateX(0); }
            to { transform: translateX(-80px); }
        }

        .car {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scaleX(-1);
        }

        .car.jump {
            animation: jumpAnim 0.5s ease;
        }

        @keyframes jumpAnim {
            0%, 100% { transform: scaleX(-1) translateY(0); }
            50% { transform: scaleX(-1) translateY(-80px) scale(1.1); }
        }

        .shake {
            animation: shake 0.2s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: scaleX(-1) translateX(0); }
            25% { transform: scaleX(-1) translateX(-4px); }
            75% { transform: scaleX(-1) translateX(4px); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-4xl bg-gray-900 rounded-3xl overflow-hidden shadow-2xl border-4 border-emerald-400">
        <!-- Header -->
        <div class="bg-emerald-400 p-4 flex justify-between items-center text-gray-900 font-game">
            <h1 class="text-xl">Typing Academy</h1>
            <div id="player-display-name" class="text-xs font-bold bg-white/30 px-2 py-1 rounded tracking-tighter">Kh√°ch</div>
        </div>

        <div id="main-content" class="relative min-h-[500px]">
            
            <!-- 1. M√†n h√¨nh nh·∫≠p t√™n -->
            <div id="name-screen" class="p-8 flex flex-col items-center justify-center space-y-6 min-h-[500px]">
                <div class="text-center space-y-2">
                    <h2 class="text-3xl font-game text-emerald-400">Ch√†o m·ª´ng t√†i x·∫ø!</h2>
                    <p class="text-gray-400">Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu h·ªçc</p>
                </div>
                <input type="text" id="name-input" maxlength="15"
                    class="w-full max-w-xs p-4 text-2xl text-center rounded-xl bg-gray-800 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all font-game"
                    placeholder="T√™n c·ªßa b·∫°n...">
                <button id="confirm-name-btn" class="bg-emerald-400 hover:bg-emerald-500 text-gray-900 font-game px-12 py-4 rounded-xl shadow-[0_6px_0_rgb(5,150,105)] transition-all active:translate-y-1 active:shadow-none">
                    B·∫ÆT ƒê·∫¶U
                </button>
            </div>

            <!-- 2. M√†n h√¨nh ch·ªçn Level -->
            <div id="level-screen" class="hidden p-8 space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-game text-emerald-400">Ch·ªçn b√†i h·ªçc</h2>
                    <span class="text-xs text-gray-400">Ho√†n th√†nh b√†i tr∆∞·ªõc ƒë·ªÉ m·ªü kh√≥a b√†i sau</span>
                </div>
                <div id="level-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-[400px] overflow-y-auto pr-2">
                    <!-- Levels generated by JS -->
                </div>
            </div>

            <!-- 3. M√†n h√¨nh ch∆°i Game -->
            <div id="game-container" class="hidden p-8 space-y-8">
                <div class="flex justify-between items-center">
                    <button id="back-to-levels" class="text-emerald-400 text-sm font-bold flex items-center gap-1 hover:underline">
                        ‚Üê Quay l·∫°i b√†i h·ªçc
                    </button>
                    <div id="current-level-title" class="text-emerald-400 font-game text-sm">Level 1: Keys f & j</div>
                </div>

                <!-- Race Tracks -->
                <div class="space-y-4">
                    <div class="relative h-12 road rounded-xl">
                        <div class="road-lines"></div>
                        <div id="player-car" class="car absolute left-0 top-1 text-4xl" style="left: 0%;">üöö</div>
                        <div class="absolute -top-6 left-0 text-[10px] font-bold text-emerald-400 uppercase tracking-widest">Ti·∫øn ƒë·ªô c·ªßa b·∫°n</div>
                    </div>
                </div>

                <!-- Typing Area -->
                <div class="bg-gray-800 p-6 rounded-2xl text-center space-y-6 border-b-8 border-gray-700">
                    <div id="word-display" class="text-5xl font-game tracking-[0.2em] min-h-[60px] flex justify-center items-center">
                        <span class="text-gray-500 italic text-lg text-center">Chu·∫©n b·ªã...</span>
                    </div>
                    
                    <input type="text" id="typing-input" 
                        class="w-full p-6 text-3xl text-center rounded-xl bg-gray-900 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all uppercase font-mono"
                        placeholder="..."
                        autocomplete="off"
                        spellcheck="false">
                    
                    <div class="flex justify-around items-center text-sm font-bold">
                        <div class="bg-gray-700 px-4 py-2 rounded-lg text-emerald-400">T·ªêC ƒê·ªò: <span id="wpm-display">0</span> WPM</div>
                        <div class="bg-gray-700 px-4 py-2 rounded-lg text-emerald-400">TI·∫æN ƒê·ªò: <span id="progress-display">0</span>/10</div>
                    </div>
                </div>
            </div>

            <!-- Overlays -->
            <div id="message-overlay" class="hidden absolute inset-0 bg-gray-900/98 flex flex-col items-center justify-center z-50 text-center p-6">
                <div class="max-w-md w-full space-y-6">
                    <div id="status-icon" class="text-7xl">üèÜ</div>
                    <h2 id="status-title" class="text-4xl font-game text-emerald-400 uppercase">Xu·∫•t S·∫Øc!</h2>
                    
                    <div class="grid grid-cols-2 gap-4 bg-gray-800 p-4 rounded-2xl border-2 border-emerald-400/30">
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">T·ªëc ƒë·ªô</div>
                            <div class="text-3xl font-game text-white"><span id="final-wpm">0</span></div>
                            <div class="text-[10px] text-gray-500">t·ª´ / ph√∫t</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">Ch√≠nh x√°c</div>
                            <div class="text-3xl font-game text-white"><span id="final-acc">0</span>%</div>
                            <div class="text-[10px] text-gray-500">kh√¥ng l·ªói</div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button id="level-menu-btn" class="flex-1 bg-gray-700 text-white font-game py-4 rounded-xl hover:bg-gray-600 transition-colors">MENU</button>
                        <button id="next-level-btn" class="flex-1 bg-emerald-400 text-gray-900 font-game py-4 rounded-xl hover:bg-emerald-300 transition-colors shadow-lg">B√ÄI TI·∫æP</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh c√°c Level
        const levels = [
            { id: 1, title: "Keys f & j", words: ["f", "j", "fj", "jf", "ff", "jj", "fjfj", "jjff"] },
            { id: 2, title: "Space Bar", words: ["f j", "j f", "ff jj", "jj ff", "f j f", "j f j"] },
            { id: 3, title: "Review: f & j", words: ["fjj", "jff", "fjf", "jf j", "f j f", "fjfj"] },
            { id: 4, title: "Keys d & k", words: ["d", "k", "dk", "kd", "dd", "kk", "dkdk", "kdkd"] },
            { id: 5, title: "Review: d & k", words: ["dkk", "kdd", "dk d", "k d k", "ddkk", "kdkd"] },
            { id: 6, title: "Practice: d & k", words: ["dkd", "kdk", "dkdk", "kkdd", "dk kd", "kd dk"] },
            { id: 7, title: "Play: fjkd", words: ["fjkd", "dkjf", "fdkj", "jkfd", "ffdd", "kkjj"] },
            { id: 8, title: "Keys s & l", words: ["s", "l", "sl", "ls", "ss", "ll", "slsl", "lsls"] },
            { id: 9, title: "Review: s & l", words: ["sll", "lss", "sl s", "l s l", "ssll", "lsls"] },
            { id: 10, title: "Practice: s & l", words: ["sls", "lsl", "slsl", "llss", "sl ls", "ls sl"] },
            { id: 11, title: "Keys a & ;", words: ["a", ";", "a;", ";a", "aa", ";;", "a;a;", ";a;a"] },
            { id: 12, title: "Review: a & ;", words: ["a;;", ";aa", "a ; a", "; a ;", "aa;;", ";a;a"] },
            { id: 13, title: "First 8 Keys", words: ["asdf", "jkl;", "asdf jkl;", "fdsa", ";lkj", "asdf;lkj"] },
            { id: 14, title: "Play: First 8 Keys", words: ["fads", "lads", "daks", "flak", "slad", "jads", "flask"] },
            { id: 15, title: "Home, Sweet Home!", words: ["asdf", "jkl;", "a;sl", "dkfj", "asdfjkl;", "home"] },
            { id: 16, title: "Home Row: L Hand", words: ["asdf", "fdsa", "asdfa", "ffss", "ddaa", "asdf asdf"] },
            { id: 17, title: "Home Row: R Hand", words: ["jkl;", ";lkj", "jkl;j", "jjkk", "ll;;", "jkl; jkl;"] },
            { id: 18, title: "Keys g & h", words: ["g", "h", "gh", "hg", "gg", "hh", "ghgh", "hghg"] },
            { id: 19, title: "Review: g & h", words: ["ghh", "hgg", "g h g", "h g h", "gghh", "hghg"] },
            { id: 20, title: "Practice: g & h", words: ["ghg", "hgh", "ghgh", "hhgg", "gh hg", "hg gh"] },
            { id: 21, title: "Home Row Review", words: ["asdfgh", "jkl;hg", "ghasdf", "ghjkl;", "asdfghjkl;"] },
            { id: 22, title: "Play Home Row", words: ["glad", "dash", "flash", "glass", "shall", "skull", "slag"] },
            { id: 23, title: "Home Row Master", words: ["salads", "alfalfa", "jagged", "shakshuka", "dashglass"] },
        ];

        let playerName = "Kh√°ch";
        let unlockedLevel = parseInt(localStorage.getItem('speedy_unlocked_level')) || 1;
        let currentLevel = null;
        let wordIndex = 0;
        let currentWords = [];
        let startTime = null;
        let totalErrors = 0;
        const TARGET_COUNT = 10;

        // Elements
        const nameScreen = document.getElementById('name-screen');
        const levelScreen = document.getElementById('level-screen');
        const gameContainer = document.getElementById('game-container');
        const levelGrid = document.getElementById('level-grid');
        const typingInput = document.getElementById('typing-input');
        const wordDisplay = document.getElementById('word-display');
        const playerCar = document.getElementById('player-car');
        const overlay = document.getElementById('message-overlay');

        // Logic ban ƒë·∫ßu
        const savedName = localStorage.getItem('speedy_last_name');
        if (savedName) document.getElementById('name-input').value = savedName;

        document.getElementById('confirm-name-btn').onclick = () => {
            const val = document.getElementById('name-input').value.trim();
            if (val) {
                playerName = val;
                document.getElementById('player-display-name').innerText = playerName;
                localStorage.setItem('speedy_last_name', playerName);
                nameScreen.classList.add('hidden');
                showLevels();
            }
        };

        function showLevels() {
            levelScreen.classList.remove('hidden');
            gameContainer.classList.add('hidden');
            overlay.classList.add('hidden');
            renderLevelGrid();
        }

        function renderLevelGrid() {
            levelGrid.innerHTML = levels.map(lvl => {
                const isLocked = lvl.id > unlockedLevel;
                return `
                    <button onclick="${isLocked ? '' : `startLevel(${lvl.id})`}" 
                        class="p-4 rounded-xl border-2 transition-all text-left flex flex-col justify-between h-24
                        ${isLocked ? 'bg-gray-800 border-gray-700 opacity-50 cursor-not-allowed' : 'bg-gray-800 border-emerald-400/30 hover:border-emerald-400 hover:scale-105'}">
                        <span class="text-[10px] font-game text-emerald-400">Level ${lvl.id}</span>
                        <span class="text-xs font-bold leading-tight">${lvl.title}</span>
                        ${isLocked ? '<span class="text-[10px]">üîí Kh√≥a</span>' : '<span class="text-[10px] text-emerald-500">‚úî S·∫µn s√†ng</span>'}
                    </button>
                `;
            }).join('');
        }

        function startLevel(id) {
            currentLevel = levels.find(l => l.id === id);
            wordIndex = 0;
            totalErrors = 0;
            // Tr·ªôn t·ª´ ng·∫´u nhi√™n cho ƒë·ªß s·ªë l∆∞·ª£ng 10
            currentWords = [];
            for(let i=0; i<TARGET_COUNT; i++) {
                currentWords.push(currentLevel.words[Math.floor(Math.random() * currentLevel.words.length)]);
            }

            document.getElementById('current-level-title').innerText = `Level ${currentLevel.id}: ${currentLevel.title}`;
            document.getElementById('progress-display').innerText = `0/${TARGET_COUNT}`;
            levelScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            typingInput.value = "";
            typingInput.disabled = false;
            typingInput.focus();
            
            playerCar.style.left = "0%";
            renderWord();
            startTime = Date.now();
        }

        function renderWord() {
            if (wordIndex >= TARGET_COUNT) {
                endGame();
                return;
            }
            const target = currentWords[wordIndex];
            const typed = typingInput.value;
            let html = "";
            let isWrong = false;

            for (let i = 0; i < target.length; i++) {
                if (i < typed.length) {
                    if (typed[i] === target[i]) html += `<span class="text-emerald-400">${target[i]}</span>`;
                    else { html += `<span class="text-red-500 underline">${target[i]}</span>`; isWrong = true; }
                } else html += `<span class="text-gray-600">${target[i]}</span>`;
            }
            wordDisplay.innerHTML = html;

            if (isWrong) { playerCar.classList.add('shake'); totalErrors++; }
            else playerCar.classList.remove('shake');

            if (typed === target) {
                wordIndex++;
                typingInput.value = "";
                moveCar();
                renderWord();
            }
        }

        function moveCar() {
            const progress = (wordIndex / TARGET_COUNT) * 90;
            playerCar.style.left = `${progress}%`;
            playerCar.classList.add('jump');
            setTimeout(() => playerCar.classList.remove('jump'), 500);
            document.getElementById('progress-display').innerText = `${wordIndex}/${TARGET_COUNT}`;
            
            const elapsed = (Date.now() - startTime) / 60000;
            document.getElementById('wpm-display').innerText = Math.round(wordIndex / elapsed) || 0;
        }

        typingInput.addEventListener('input', renderWord);

        function endGame() {
            const timeElapsed = (Date.now() - startTime) / 60000;
            const finalWpm = Math.round(TARGET_COUNT / timeElapsed);
            // T√≠nh ƒë·ªô ch√≠nh x√°c d·ª±a tr√™n s·ªë ph√≠m g√µ sai
            const totalChars = currentWords.join('').length;
            const accuracy = Math.max(0, Math.round(((totalChars - totalErrors) / totalChars) * 100));

            typingInput.disabled = true;
            document.getElementById('final-wpm').innerText = finalWpm;
            document.getElementById('final-acc').innerText = accuracy;
            overlay.classList.remove('hidden');

            // M·ªü kh√≥a level ti·∫øp theo n·∫øu th·∫Øng (Accuracy > 80% ch·∫≥ng h·∫°n)
            if (accuracy >= 80) {
                if (currentLevel.id === unlockedLevel && unlockedLevel < 23) {
                    unlockedLevel++;
                    localStorage.setItem('speedy_unlocked_level', unlockedLevel);
                }
                document.getElementById('status-title').innerText = "Ho√†n Th√†nh!";
                document.getElementById('status-icon').innerText = "üèÜ";
            } else {
                document.getElementById('status-title').innerText = "Th·ª≠ L·∫°i!";
                document.getElementById('status-icon').innerText = "üîÑ";
            }
        }

        document.getElementById('back-to-levels').onclick = showLevels;
        document.getElementById('level-menu-btn').onclick = showLevels;
        document.getElementById('next-level-btn').onclick = () => {
            if (currentLevel.id < 23) startLevel(currentLevel.id + 1);
            else showLevels();
        };

    </script>
</body>
</html>
