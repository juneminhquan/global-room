<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedy Delivery Express - Typing Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #1a1a2e;
            color: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .font-game {
            font-family: 'Bungee', cursive;
        }

        .road {
            background: linear-gradient(0deg, #333 0%, #444 50%, #333 100%);
            background-size: 100% 40px;
            position: relative;
            overflow: hidden;
        }

        .road-lines {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(90deg, #fff, #fff 40px, transparent 40px, transparent 80px);
            animation: moveRoad 1s linear infinite;
        }

        @keyframes moveRoad {
            from { transform: translateX(0); }
            to { transform: translateX(-80px); }
        }

        .car {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scaleX(-1);
        }

        .car.jump {
            animation: jumpAnim 0.5s ease;
        }

        @keyframes jumpAnim {
            0%, 100% { transform: scaleX(-1) translateY(0); }
            50% { transform: scaleX(-1) translateY(-80px) scale(1.1); }
        }

        .shake {
            animation: shake 0.2s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: scaleX(-1) translateX(0); }
            25% { transform: scaleX(-1) translateX(-4px); }
            75% { transform: scaleX(-1) translateX(4px); }
        }

        /* Virtual Keyboard Styles - Fixed Centering */
        .key {
            @apply flex items-center justify-center bg-gray-700 rounded text-xs font-bold transition-all text-gray-300;
            height: 44px;
            min-width: 36px;
            user-select: none;
            position: relative;
            box-sizing: border-box;
            border-bottom: 4px solid #000;
            padding-bottom: 4px; /* Offset the text upwards to visually center against the shadow */
        }
        
        .key.active {
            @apply bg-emerald-400 text-gray-900;
            border-bottom-color: #059669;
            animation: glow-pulse 1.5s infinite ease-in-out;
            z-index: 10;
        }

        @keyframes glow-pulse {
            0% { box-shadow: 0 0 5px rgba(52, 211, 153, 0.4); filter: brightness(1); }
            50% { box-shadow: 0 0 25px rgba(52, 211, 153, 0.9); filter: brightness(1.2); }
            100% { box-shadow: 0 0 5px rgba(52, 211, 153, 0.4); filter: brightness(1); }
        }

        .key.shift-active {
            @apply bg-purple-500 text-white;
            border-bottom-color: #6b21a8;
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.5);
        }

        .key.pressed {
            @apply bg-white text-gray-900;
            border-bottom-width: 0;
            transform: translateY(4px);
            padding-bottom: 0; /* Reset padding when pressed */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        .key-space { width: 200px; }
        .key-shift { width: 70px; }
        
        @media (max-width: 640px) {
            .key { height: 38px; min-width: 28px; font-size: 10px; }
            .key-space { width: 140px; }
            .key-shift { width: 50px; }
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-4xl bg-gray-900 rounded-3xl overflow-hidden shadow-2xl border-4 border-emerald-400 flex flex-col">
        <!-- Header -->
        <div class="bg-emerald-400 p-4 flex justify-between items-center text-gray-900 font-game shrink-0">
            <h1 class="text-xl">Typing Academy</h1>
            <div id="player-display-name" class="text-xs font-bold bg-white/30 px-2 py-1 rounded tracking-tighter">Kh√°ch</div>
        </div>

        <div id="main-content" class="relative flex-grow">
            <!-- screens same as before -->
            <div id="name-screen" class="p-8 flex flex-col items-center justify-center space-y-6 min-h-[500px]">
                <div class="text-center space-y-2">
                    <h2 class="text-3xl font-game text-emerald-400">Ch√†o t√†i x·∫ø!</h2>
                    <p class="text-gray-400">Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ ti·∫øp t·ª•c l·ªô tr√¨nh</p>
                </div>
                <input type="text" id="name-input" maxlength="15"
                    class="w-full max-w-xs p-4 text-2xl text-center rounded-xl bg-gray-800 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all font-game"
                    placeholder="T√™n c·ªßa b·∫°n...">
                <button id="confirm-name-btn" class="bg-emerald-400 hover:bg-emerald-500 text-gray-900 font-game px-12 py-4 rounded-xl shadow-[0_6px_0_rgb(5,150,105)] transition-all active:translate-y-1 active:shadow-none">
                    TI·∫æP T·ª§C
                </button>
            </div>

            <div id="level-screen" class="hidden p-8 space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-game text-emerald-400">L·ªô tr√¨nh h·ªçc t·∫≠p</h2>
                    <span id="unlocked-count" class="text-xs text-gray-400 font-bold bg-gray-800 px-3 py-1 rounded-full border border-gray-700"></span>
                </div>
                <div id="level-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-[400px] overflow-y-auto pr-2 pb-4"></div>
            </div>

            <div id="game-container" class="hidden p-6 space-y-6 flex flex-col h-full">
                <div class="flex justify-between items-center shrink-0">
                    <button id="back-to-levels" class="text-emerald-400 text-sm font-bold flex items-center gap-1 hover:underline">‚Üê Danh s√°ch b√†i h·ªçc</button>
                    <div id="current-level-title" class="text-emerald-400 font-game text-sm">Level 1</div>
                </div>

                <div class="space-y-4 shrink-0">
                    <div class="relative h-12 road rounded-xl">
                        <div class="road-lines"></div>
                        <div id="player-car" class="car absolute left-0 top-1 text-4xl" style="left: 0%;">üöö</div>
                    </div>
                </div>

                <div class="bg-gray-800 p-4 rounded-2xl text-center space-y-4 border-b-8 border-gray-700 shrink-0">
                    <div id="word-display" class="text-4xl font-game tracking-[0.2em] min-h-[50px] flex justify-center items-center">
                        <span class="text-gray-500 italic text-lg text-center">Chu·∫©n b·ªã...</span>
                    </div>
                    <input type="text" id="typing-input" class="w-full p-4 text-2xl text-center rounded-xl bg-gray-900 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all font-mono" placeholder="..." autocomplete="off" spellcheck="false">
                    <div class="flex justify-around items-center text-[10px] font-bold">
                        <div class="bg-gray-700 px-3 py-1 rounded text-emerald-400 uppercase tracking-widest">T·ªëc ƒë·ªô: <span id="wpm-display">0</span> WPM</div>
                        <div class="bg-gray-700 px-3 py-1 rounded text-emerald-400 uppercase tracking-widest">Ti·∫øn ƒë·ªô: <span id="progress-display">0</span>/10</div>
                    </div>
                </div>

                <div id="virtual-keyboard" class="bg-gray-950 p-4 rounded-2xl border-2 border-gray-800 space-y-2 select-none shadow-inner">
                    <div class="flex justify-center gap-1.5" id="kb-row-1"></div>
                    <div class="flex justify-center gap-1.5" id="kb-row-2"></div>
                    <div class="flex justify-center gap-1.5" id="kb-row-3"></div>
                    <div class="flex justify-center gap-1.5" id="kb-row-4"></div>
                </div>
            </div>

            <div id="message-overlay" class="hidden absolute inset-0 bg-gray-900/98 flex flex-col items-center justify-center z-50 text-center p-6">
                <!-- Overlay content -->
                <div class="max-w-md w-full space-y-6">
                    <div id="status-icon" class="text-7xl">üèÜ</div>
                    <h2 id="status-title" class="text-4xl font-game text-emerald-400 uppercase">Xu·∫•t S·∫Øc!</h2>
                    <div class="grid grid-cols-2 gap-4 bg-gray-800 p-4 rounded-2xl border-2 border-emerald-400/30">
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">T·ªëc ƒë·ªô</div>
                            <div class="text-3xl font-game text-white"><span id="final-wpm">0</span></div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">Ch√≠nh x√°c</div>
                            <div class="text-3xl font-game text-white"><span id="final-acc">0</span>%</div>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button id="level-menu-btn" class="flex-1 bg-gray-700 text-white font-game py-4 rounded-xl hover:bg-gray-600 transition-colors">MENU</button>
                        <button id="next-level-btn" class="flex-1 bg-emerald-400 text-gray-900 font-game py-4 rounded-xl hover:bg-emerald-300 transition-colors shadow-lg">TI·∫æP THEO</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const levels = [
            { id: 1, title: "Keys f & j", words: ["f", "j", "fj", "jf"] },
            { id: 2, title: "Space Bar", words: ["f j", "j f", "ff jj"] },
            { id: 3, title: "Review: f & j", words: ["fjj", "jff", "fjfj"] },
            { id: 4, title: "Keys d & k", words: ["d", "k", "dk", "kd"] },
            { id: 5, title: "Review: d & k", words: ["dkk", "kdd", "dk d"] },
            { id: 6, title: "Practice: d & k", words: ["dkd", "kdk", "dk kd"] },
            { id: 7, title: "Play: fjkd", words: ["fjkd", "dkjf", "fdkj"] },
            { id: 8, title: "Keys s & l", words: ["s", "l", "sl", "ls"] },
            { id: 9, title: "Review: s & l", words: ["sll", "lss", "sl s"] },
            { id: 10, title: "Practice: s & l", words: ["sls", "lsl", "sl ls"] },
            { id: 11, title: "Keys a & ;", words: ["a", ";", "a;", ";a"] },
            { id: 12, title: "Review: a & ;", words: ["a;;", ";aa", "a ; a"] },
            { id: 13, title: "First 8 Keys", words: ["asdf", "jkl;", "asdf jkl;"] },
            { id: 14, title: "Play: First 8 Keys", words: ["fads", "lads", "daks", "flak"] },
            { id: 15, title: "Home, Sweet Home!", words: ["asdf", "jkl;", "a;sl", "home"] },
            { id: 16, title: "Home Row: L Hand", words: ["asdf", "fdsa", "ffss"] },
            { id: 17, title: "Home Row: R Hand", words: ["jkl;", ";lkj", "jjkk"] },
            { id: 18, title: "Keys g & h", words: ["g", "h", "gh", "hg"] },
            { id: 19, title: "Review: g & h", words: ["ghh", "hgg", "g h g"] },
            { id: 20, title: "Practice: g & h", words: ["ghg", "hgh", "gh hg"] },
            { id: 21, title: "Home Row Review", words: ["asdfgh", "jkl;hg", "ghasdf"] },
            { id: 22, title: "Play Home Row", words: ["glad", "dash", "flash", "glass"] },
            { id: 23, title: "Home Row Master", words: ["salads", "alfalfa", "jagged"] },
            { id: 24, title: "Keys r & u", words: ["r", "u", "ru", "ur"] },
            { id: 25, title: "Review: r & u", words: ["ruu", "urr", "r u r"] },
            { id: 26, title: "Practice: r & u", words: ["ruur", "urru", "fur"] },
            { id: 27, title: "Keys e & i", words: ["e", "i", "ei", "ie"] },
            { id: 28, title: "Review: e & i", words: ["eii", "iee", "e i e"] },
            { id: 29, title: "Practice: e & i", words: ["eiei", "ieie", "die"] },
            { id: 30, title: "Sit Straight!", words: ["sit", "tall", "back", "flex"] },
            { id: 31, title: "Review: Home + ruei", words: ["rude", "fire", "duke", "life"] },
            { id: 32, title: "Top Row: L Hand", words: ["qwer", "rewq", "tree", "deer"] },
            { id: 33, title: "Top Row: R Hand", words: ["uiop", "poiu", "pool", "look"] },
            { id: 34, title: "Play: ruei", words: ["ride", "rule", "free", "idle"] },
            { id: 35, title: "Keys w & o", words: ["w", "o", "wo", "ow"] },
            { id: 36, title: "Review: w & o", words: ["woo", "oww", "w o w"] },
            { id: 37, title: "Practice: w & o", words: ["wood", "wolf", "slow", "show"] },
            { id: 38, title: "Play: Top 6 Keys", words: ["wrote", "power", "tower", "quiet"] },
            { id: 39, title: "Keys q & y", words: ["q", "y", "qy", "yq"] },
            { id: 40, title: "Review: q & y", words: ["qyy", "yqq", "q y q"] },
            { id: 41, title: "Practice: q & y", words: ["yard", "quay", "year", "play"] },
            { id: 42, title: "Keys p & t", words: ["p", "t", "pt", "tp"] },
            { id: 43, title: "Review: p & t", words: ["ptt", "tpp", "p t p"] },
            { id: 44, title: "Practice: p & t", words: ["part", "trip", "past", "stop"] },
            { id: 45, title: "Play: Top Row", words: ["top", "row", "type", "word"] },
            { id: 82, title: "Shift Key Basics", words: ["A", "J", "K", "L", "S", "D"] },
            { id: 83, title: "Left Shift: R Hand", words: ["J", "K", "L", "M", "I", "O"] },
            { id: 84, title: "Right Shift: L Hand", words: ["A", "S", "D", "F", "E", "Q"] },
            { id: 85, title: "Shift Review", words: ["Aa", "Jj", "Ss", "Kk", "Dd", "Ll"] },
            { id: 86, title: "Names", words: ["Anna", "Jack", "Luis", "Sara", "Dan"] },
            { id: 101, title: "Graduation!", words: ["I can type!", "The End.", "Victory!"] }
        ];

        let playerName = "Kh√°ch";
        let unlockedLevel = parseInt(localStorage.getItem('speedy_unlocked_level')) || 1;
        let currentLevel = null;
        let wordIndex = 0;
        let currentWords = [];
        let startTime = null;
        let totalErrors = 0;
        const TARGET_COUNT = 10;

        const nameScreen = document.getElementById('name-screen');
        const levelScreen = document.getElementById('level-screen');
        const gameContainer = document.getElementById('game-container');
        const levelGrid = document.getElementById('level-grid');
        const typingInput = document.getElementById('typing-input');
        const wordDisplay = document.getElementById('word-display');
        const playerCar = document.getElementById('player-car');
        const overlay = document.getElementById('message-overlay');

        const rows = [
            ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
            ["A", "S", "D", "F", "G", "H", "J", "K", "L", ";"],
            ["Shift", "Z", "X", "C", "V", "B", "N", "M", ",", ".", "/"],
            ["Space"]
        ];

        function initKeyboard() {
            rows.forEach((row, i) => {
                const rowDiv = document.getElementById(`kb-row-${i + 1}`);
                rowDiv.innerHTML = row.map(key => {
                    let extraClass = "";
                    if (key === "Space") extraClass = "key-space";
                    if (key === "Shift") extraClass = "key-shift";
                    const displayKey = key === "Space" ? "SPACE" : key;
                    const id = key.toLowerCase();
                    return `<div class="key ${extraClass}" id="key-${id}">${displayKey}</div>`;
                }).join('');
            });
        }

        initKeyboard();

        const savedName = localStorage.getItem('speedy_last_name');
        if (savedName) document.getElementById('name-input').value = savedName;

        document.getElementById('confirm-name-btn').onclick = () => {
            const val = document.getElementById('name-input').value.trim();
            if (val) {
                playerName = val;
                document.getElementById('player-display-name').innerText = playerName;
                localStorage.setItem('speedy_last_name', playerName);
                nameScreen.classList.add('hidden');
                showLevels();
            }
        };

        function showLevels() {
            levelScreen.classList.remove('hidden');
            gameContainer.classList.add('hidden');
            overlay.classList.add('hidden');
            document.getElementById('unlocked-count').innerText = `Ti·∫øn ƒë·ªô: ${unlockedLevel}/${levels.length}`;
            renderLevelGrid();
        }

        function renderLevelGrid() {
            levelGrid.innerHTML = levels.map(lvl => {
                const isLocked = lvl.id > unlockedLevel;
                const isCompleted = lvl.id < unlockedLevel;
                let colorClass = isLocked ? 'bg-gray-800 border-gray-700 opacity-50' : isCompleted ? 'bg-gray-800 border-emerald-400' : 'bg-gray-800 border-yellow-400';
                return `<button onclick="${isLocked ? '' : `startLevel(${lvl.id})`}" class="p-4 rounded-xl border-2 transition-all text-left flex flex-col justify-between h-24 relative overflow-hidden ${colorClass} ${!isLocked ? 'hover:scale-105 active:scale-95' : 'cursor-not-allowed'}"><span class="text-[10px] font-game ${isLocked ? 'text-gray-500' : 'text-emerald-400'}">B√†i ${lvl.id}</span><span class="text-xs font-bold leading-tight pr-4 line-clamp-2">${lvl.title}</span><span class="text-[10px] ${isLocked ? 'text-gray-500' : 'text-emerald-500 font-bold'}">${isLocked ? 'üîí KH√ìA' : isCompleted ? '‚úî XONG' : '‚ñ∂ H·ªåC'}</span></button>`;
            }).join('');
        }

        function startLevel(id) {
            currentLevel = levels.find(l => l.id === id) || levels[0];
            wordIndex = 0;
            totalErrors = 0;
            currentWords = [];
            for(let i=0; i<TARGET_COUNT; i++) currentWords.push(currentLevel.words[Math.floor(Math.random() * currentLevel.words.length)]);
            document.getElementById('current-level-title').innerText = `Level ${currentLevel.id}: ${currentLevel.title}`;
            document.getElementById('progress-display').innerText = `0/${TARGET_COUNT}`;
            levelScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            typingInput.value = "";
            typingInput.disabled = false;
            typingInput.focus();
            playerCar.style.left = "0%";
            renderWord();
            startTime = Date.now();
        }

        function renderWord() {
            if (wordIndex >= TARGET_COUNT) { endGame(); return; }
            const target = currentWords[wordIndex];
            const typed = typingInput.value;
            let html = "";
            let isWrong = false;
            for (let i = 0; i < target.length; i++) {
                if (i < typed.length) {
                    if (typed[i] === target[i]) html += `<span class="text-emerald-400">${target[i]}</span>`;
                    else { html += `<span class="text-red-500 underline">${target[i]}</span>`; isWrong = true; }
                } else html += `<span class="text-gray-400">${target[i]}</span>`;
            }
            wordDisplay.innerHTML = html;
            highlightNextKey(target[typed.length]);
            if (isWrong) { playerCar.classList.add('shake'); totalErrors++; }
            else playerCar.classList.remove('shake');
            if (typed === target) { wordIndex++; typingInput.value = ""; moveCar(); renderWord(); }
        }

        function highlightNextKey(char) {
            document.querySelectorAll('.key').forEach(k => k.classList.remove('active', 'shift-active'));
            if (char === undefined) return;
            let keyId = char.toLowerCase();
            if (char === " ") keyId = "space";
            const keyEl = document.getElementById(`key-${keyId}`);
            if (keyEl) keyEl.classList.add('active');
            const isCapital = (char >= 'A' && char <= 'Z');
            if (isCapital) document.getElementById('key-shift').classList.add('shift-active');
        }

        function moveCar() {
            const progress = (wordIndex / TARGET_COUNT) * 90;
            playerCar.style.left = `${progress}%`;
            playerCar.classList.add('jump');
            setTimeout(() => playerCar.classList.remove('jump'), 500);
            document.getElementById('progress-display').innerText = `${wordIndex}/${TARGET_COUNT}`;
            const elapsed = (Date.now() - startTime) / 60000;
            document.getElementById('wpm-display').innerText = Math.round(wordIndex / elapsed) || 0;
        }

        typingInput.addEventListener('input', renderWord);

        window.addEventListener('keydown', (e) => {
            let key = e.key.toLowerCase();
            if (key === " ") key = "space";
            const el = document.getElementById(`key-${key}`);
            if (el) el.classList.add('pressed');
        });

        window.addEventListener('keyup', (e) => {
            let key = e.key.toLowerCase();
            if (key === " ") key = "space";
            const el = document.getElementById(`key-${key}`);
            if (el) el.classList.remove('pressed');
        });

        function endGame() {
            const timeElapsed = (Date.now() - startTime) / 60000;
            const finalWpm = Math.round(TARGET_COUNT / timeElapsed);
            const totalChars = currentWords.join('').length;
            const accuracy = Math.max(0, Math.round(((totalChars - totalErrors) / totalChars) * 100));
            typingInput.disabled = true;
            document.getElementById('final-wpm').innerText = finalWpm;
            document.getElementById('final-acc').innerText = accuracy;
            overlay.classList.remove('hidden');
            if (accuracy >= 80) {
                if (currentLevel.id === unlockedLevel && unlockedLevel < levels.length) {
                    unlockedLevel++;
                    localStorage.setItem('speedy_unlocked_level', unlockedLevel);
                }
                document.getElementById('status-title').innerText = "Th√†nh C√¥ng!";
                document.getElementById('status-icon').innerText = "üèÜ";
                document.getElementById('next-level-btn').classList.remove('hidden');
            } else {
                document.getElementById('status-title').innerText = "C·∫ßn C·ªë G·∫Øng!";
                document.getElementById('status-icon').innerText = "üîÑ";
                document.getElementById('next-level-btn').classList.add('hidden');
            }
        }

        document.getElementById('back-to-levels').onclick = showLevels;
        document.getElementById('level-menu-btn').onclick = showLevels;
        document.getElementById('next-level-btn').onclick = () => {
            const currentIdx = levels.findIndex(l => l.id === currentLevel.id);
            if (currentIdx < levels.length - 1) startLevel(levels[currentIdx + 1].id);
            else showLevels();
        };
    </script>
</body>
</html>
