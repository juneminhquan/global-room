<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedy Delivery Express - Typing Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #1a1a2e;
            color: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .font-game {
            font-family: 'Bungee', cursive;
        }

        .road {
            background: linear-gradient(0deg, #333 0%, #444 50%, #333 100%);
            background-size: 100% 40px;
            position: relative;
            overflow: hidden;
        }

        .road-lines {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(90deg, #fff, #fff 40px, transparent 40px, transparent 80px);
            animation: moveRoad 1s linear infinite;
        }

        @keyframes moveRoad {
            from { transform: translateX(0); }
            to { transform: translateX(-80px); }
        }

        .car {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scaleX(-1);
        }

        .car.jump {
            animation: jumpAnim 0.5s ease;
        }

        @keyframes jumpAnim {
            0%, 100% { transform: scaleX(-1) translateY(0); }
            50% { transform: scaleX(-1) translateY(-80px) scale(1.1); }
        }

        .shake {
            animation: shake 0.2s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: scaleX(-1) translateX(0); }
            25% { transform: scaleX(-1) translateX(-4px); }
            75% { transform: scaleX(-1) translateX(4px); }
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-4xl bg-gray-900 rounded-3xl overflow-hidden shadow-2xl border-4 border-emerald-400">
        <!-- Header -->
        <div class="bg-emerald-400 p-4 flex justify-between items-center text-gray-900 font-game">
            <h1 class="text-xl">Typing Academy</h1>
            <div id="player-display-name" class="text-xs font-bold bg-white/30 px-2 py-1 rounded tracking-tighter">Kh√°ch</div>
        </div>

        <div id="main-content" class="relative min-h-[500px]">
            <!-- 1. M√†n h√¨nh nh·∫≠p t√™n -->
            <div id="name-screen" class="p-8 flex flex-col items-center justify-center space-y-6 min-h-[500px]">
                <div class="text-center space-y-2">
                    <h2 class="text-3xl font-game text-emerald-400">Ch√†o t√†i x·∫ø!</h2>
                    <p class="text-gray-400">Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ ti·∫øp t·ª•c l·ªô tr√¨nh</p>
                </div>
                <input type="text" id="name-input" maxlength="15"
                    class="w-full max-w-xs p-4 text-2xl text-center rounded-xl bg-gray-800 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all font-game"
                    placeholder="T√™n c·ªßa b·∫°n...">
                <button id="confirm-name-btn" class="bg-emerald-400 hover:bg-emerald-500 text-gray-900 font-game px-12 py-4 rounded-xl shadow-[0_6px_0_rgb(5,150,105)] transition-all active:translate-y-1 active:shadow-none">
                    TI·∫æP T·ª§C
                </button>
            </div>

            <!-- 2. M√†n h√¨nh ch·ªçn Level -->
            <div id="level-screen" class="hidden p-8 space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-game text-emerald-400">L·ªô tr√¨nh h·ªçc t·∫≠p</h2>
                    <span id="unlocked-count" class="text-xs text-gray-400 font-bold bg-gray-800 px-3 py-1 rounded-full border border-gray-700"></span>
                </div>
                <div id="level-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-[450px] overflow-y-auto pr-2 pb-4">
                    <!-- Levels generated by JS -->
                </div>
            </div>

            <!-- 3. M√†n h√¨nh ch∆°i Game -->
            <div id="game-container" class="hidden p-8 space-y-8">
                <div class="flex justify-between items-center">
                    <button id="back-to-levels" class="text-emerald-400 text-sm font-bold flex items-center gap-1 hover:underline">
                        ‚Üê Danh s√°ch b√†i h·ªçc
                    </button>
                    <div id="current-level-title" class="text-emerald-400 font-game text-sm">Level 1</div>
                </div>

                <div class="space-y-4">
                    <div class="relative h-12 road rounded-xl">
                        <div class="road-lines"></div>
                        <div id="player-car" class="car absolute left-0 top-1 text-4xl" style="left: 0%;">üöö</div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-2xl text-center space-y-6 border-b-8 border-gray-700">
                    <div id="word-display" class="text-5xl font-game tracking-[0.2em] min-h-[60px] flex justify-center items-center">
                        <span class="text-gray-500 italic text-lg text-center">Chu·∫©n b·ªã...</span>
                    </div>
                    
                    <input type="text" id="typing-input" 
                        class="w-full p-6 text-3xl text-center rounded-xl bg-gray-900 border-4 border-gray-700 focus:outline-none focus:border-emerald-400 transition-all font-mono"
                        placeholder="..."
                        autocomplete="off"
                        spellcheck="false">
                    
                    <div class="flex justify-around items-center text-sm font-bold">
                        <div class="bg-gray-700 px-4 py-2 rounded-lg text-emerald-400">T·ªêC ƒê·ªò: <span id="wpm-display">0</span> WPM</div>
                        <div class="bg-gray-700 px-4 py-2 rounded-lg text-emerald-400">TI·∫æN ƒê·ªò: <span id="progress-display">0</span>/10</div>
                    </div>
                </div>
            </div>

            <!-- Overlays -->
            <div id="message-overlay" class="hidden absolute inset-0 bg-gray-900/98 flex flex-col items-center justify-center z-50 text-center p-6">
                <div class="max-w-md w-full space-y-6">
                    <div id="status-icon" class="text-7xl">üèÜ</div>
                    <h2 id="status-title" class="text-4xl font-game text-emerald-400 uppercase">Xu·∫•t S·∫Øc!</h2>
                    
                    <div class="grid grid-cols-2 gap-4 bg-gray-800 p-4 rounded-2xl border-2 border-emerald-400/30">
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">T·ªëc ƒë·ªô</div>
                            <div class="text-3xl font-game text-white"><span id="final-wpm">0</span></div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-[10px] uppercase">Ch√≠nh x√°c</div>
                            <div class="text-3xl font-game text-white"><span id="final-acc">0</span>%</div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button id="level-menu-btn" class="flex-1 bg-gray-700 text-white font-game py-4 rounded-xl hover:bg-gray-600 transition-colors">MENU</button>
                        <button id="next-level-btn" class="flex-1 bg-emerald-400 text-gray-900 font-game py-4 rounded-xl hover:bg-emerald-300 transition-colors shadow-lg">TI·∫æP THEO</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const levels = [
            // Home Row (1-23)
            { id: 1, title: "Keys f & j", words: ["f", "j", "fj", "jf"] },
            { id: 2, title: "Space Bar", words: ["f j", "j f", "ff jj"] },
            { id: 3, title: "Review: f & j", words: ["fjj", "jff", "fjfj"] },
            { id: 4, title: "Keys d & k", words: ["d", "k", "dk", "kd"] },
            { id: 5, title: "Review: d & k", words: ["dkk", "kdd", "dk d"] },
            { id: 6, title: "Practice: d & k", words: ["dkd", "kdk", "dk kd"] },
            { id: 7, title: "Play: fjkd", words: ["fjkd", "dkjf", "fdkj"] },
            { id: 8, title: "Keys s & l", words: ["s", "l", "sl", "ls"] },
            { id: 9, title: "Review: s & l", words: ["sll", "lss", "sl s"] },
            { id: 10, title: "Practice: s & l", words: ["sls", "lsl", "sl ls"] },
            { id: 11, title: "Keys a & ;", words: ["a", ";", "a;", ";a"] },
            { id: 12, title: "Review: a & ;", words: ["a;;", ";aa", "a ; a"] },
            { id: 13, title: "First 8 Keys", words: ["asdf", "jkl;", "asdf jkl;"] },
            { id: 14, title: "Play: First 8 Keys", words: ["fads", "lads", "daks", "flak"] },
            { id: 15, title: "Home, Sweet Home!", words: ["asdf", "jkl;", "a;sl", "home"] },
            { id: 16, title: "Home Row: L Hand", words: ["asdf", "fdsa", "ffss"] },
            { id: 17, title: "Home Row: R Hand", words: ["jkl;", ";lkj", "jjkk"] },
            { id: 18, title: "Keys g & h", words: ["g", "h", "gh", "hg"] },
            { id: 19, title: "Review: g & h", words: ["ghh", "hgg", "g h g"] },
            { id: 20, title: "Practice: g & h", words: ["ghg", "hgh", "gh hg"] },
            { id: 21, title: "Home Row Review", words: ["asdfgh", "jkl;hg", "ghasdf"] },
            { id: 22, title: "Play Home Row", words: ["glad", "dash", "flash", "glass"] },
            { id: 23, title: "Home Row Master", words: ["salads", "alfalfa", "jagged"] },

            // Top Row (24-51)
            { id: 24, title: "Keys r & u", words: ["r", "u", "ru", "ur"] },
            { id: 25, title: "Review: r & u", words: ["ruu", "urr", "r u r"] },
            { id: 26, title: "Practice: r & u", words: ["ruur", "urru", "fur"] },
            { id: 27, title: "Keys e & i", words: ["e", "i", "ei", "ie"] },
            { id: 28, title: "Review: e & i", words: ["eii", "iee", "e i e"] },
            { id: 29, title: "Practice: e & i", words: ["eiei", "ieie", "die"] },
            { id: 30, title: "Sit Straight, Be Healthy!", words: ["sit", "tall", "back", "flex"] },
            { id: 31, title: "Review: Home + ruei", words: ["rude", "fire", "duke", "life"] },
            { id: 32, title: "Top Row: Left Hand", words: ["qwer", "rewq", "tree", "deer"] },
            { id: 33, title: "Top Row: Right Hand", words: ["uiop", "poiu", "pool", "look"] },
            { id: 34, title: "Play: ruei", words: ["ride", "rule", "free", "idle"] },
            { id: 35, title: "Keys w & o", words: ["w", "o", "wo", "ow"] },
            { id: 36, title: "Review: w & o", words: ["woo", "oww", "w o w"] },
            { id: 37, title: "Practice: w & o", words: ["wood", "wolf", "slow", "show"] },
            { id: 38, title: "Play: Top 6 Keys", words: ["wrote", "power", "tower", "quiet"] },
            { id: 39, title: "Keys q & y", words: ["q", "y", "qy", "yq"] },
            { id: 40, title: "Review: q & y", words: ["qyy", "yqq", "q y q"] },
            { id: 41, title: "Practice: q & y", words: ["yard", "quay", "year", "play"] },
            { id: 42, title: "Keys p & t", words: ["p", "t", "pt", "tp"] },
            { id: 43, title: "Review: p & t", words: ["ptt", "tpp", "p t p"] },
            { id: 44, title: "Practice: p & t", words: ["part", "trip", "past", "stop"] },
            { id: 45, title: "Play: Top Row", words: ["top", "row", "type", "word"] },
            { id: 46, title: "Think Ideas, Not Fingers!", words: ["idea", "think", "fast", "mind"] },
            { id: 47, title: "Review: Home + Top", words: ["house", "table", "chair", "light"] },
            { id: 48, title: "Top Row: Left Hand", words: ["qwerty", "water", "great"] },
            { id: 49, title: "Top Row: Right Hand", words: ["uiop", "young", "point"] },
            { id: 50, title: "Play: Top Row", words: ["quickly", "player", "trophy"] },
            { id: 51, title: "Master: Top Row", words: ["quality", "property", "victory"] },

            // Bottom Row (52-81)
            { id: 52, title: "Keys v & m", words: ["v", "m", "vm", "mv"] },
            { id: 53, title: "Review: v & m", words: ["vmm", "mvv", "v m v"] },
            { id: 54, title: "Practice: v & m", words: ["move", "view", "vamp"] },
            { id: 55, title: "Travel R Index", words: ["j m", "m j", "jmj"] },
            { id: 56, title: "Travel L Index", words: ["f v", "v f", "fvf"] },
            { id: 57, title: "Keys c & ,", words: ["c", ",", "c,", ",c"] },
            { id: 58, title: "Review: c & ,", words: ["c,,", ",cc", "c , c"] },
            { id: 59, title: "Practice: c & ,", words: ["cake", "city", "ice,"] },
            { id: 60, title: "Travel R Middle", words: ["k ,", ", k", "k,k"] },
            { id: 61, title: "Travel L Middle", words: ["d c", "c d", "dcd"] },
            { id: 62, title: "Play: vmc,", words: ["cave", "come", "mice"] },
            { id: 63, title: "History of QWERTY", words: ["type", "keys", "old"] },
            { id: 64, title: "Keys x & .", words: ["x", ".", "x.", ".x"] },
            { id: 65, title: "Review: x & .", words: ["x..", ".xx", "x . x"] },
            { id: 66, title: "Practice: x & .", words: ["six.", "box.", "fox."] },
            { id: 67, title: "Travel R Ring", words: ["l .", ". l", "l.l"] },
            { id: 68, title: "Travel L Ring", words: ["s x", "x s", "sxs"] },
            { id: 69, title: "Keys z & /", words: ["z", "/", "z/", "/z"] },
            { id: 70, title: "Review: z & /", words: ["z//", "/zz", "z / z"] },
            { id: 71, title: "Practice: z & /", words: ["zoo/", "zip/", "jazz"] },
            { id: 72, title: "Travel R Pinky", words: ["; /", "/ ;", ";/;"] },
            { id: 73, title: "Travel L Pinky", words: ["a z", "z a", "aza"] },
            { id: 74, title: "Play: Bottom Row", words: ["zebra", "extra", "voice"] },
            { id: 75, title: "Keys b & n", words: ["b", "n", "bn", "nb"] },
            { id: 76, title: "Review: b & n", words: ["bnn", "nbb", "b n b"] },
            { id: 77, title: "Practice: b & n", words: ["born", "bank", "blue"] },
            { id: 78, title: "Take a Break!", words: ["rest", "eyes", "walk"] },
            { id: 79, title: "Bottom Row: L Hand", words: ["zxcvb", "bvcxz", "back"] },
            { id: 80, title: "Bottom Row: R Hand", words: ["nm,./", "/.,mn", "moon"] },
            { id: 81, title: "Practice Bottom Row", words: ["between", "vibrant", "complex"] },

            // Shift Key (82-101)
            { id: 82, title: "The Shift Key", words: ["A", "J", "K", "L", "S", "D"] },
            { id: 83, title: "Left Shift: R Hand", words: ["J", "K", "L", "M", "I", "O"] },
            { id: 84, title: "Right Shift: L Hand", words: ["A", "S", "D", "F", "E", "Q"] },
            { id: 85, title: "Shift Review", words: ["Aa", "Jj", "Ss", "Kk", "Dd", "Ll"] },
            { id: 86, title: "Practice: Names", words: ["Anna", "Jack", "Luis", "Sara", "Dan"] },
            { id: 87, title: "Keys ? & !", words: ["?", "!", "Hey!", "Go?", "Yes!"] },
            { id: 88, title: "Review: Caps 1", words: ["Apple", "Juice", "Water", "Bread"] },
            { id: 89, title: "Review: Caps 2", words: ["London", "Paris", "Tokyo", "Hanoi"] },
            { id: 90, title: "Play: Capitals", words: ["Queen", "King", "Prince", "Zebra"] },
            { id: 91, title: "Shift + Top Row", words: ["Quality", "Energy", "India", "Ocean"] },
            { id: 92, title: "Shift + Bottom Row", words: ["Vivid", "Mexico", "Brazil", "Xray"] },
            { id: 93, title: "Sentences 1", words: ["I am fast.", "She is here.", "He can run."] },
            { id: 94, title: "Sentences 2", words: ["Do you like?", "It is fun!", "Look at that."] },
            { id: 95, title: "Proper Nouns", words: ["Microsoft", "Google", "Apple", "Nike"] },
            { id: 96, title: "Quotes", words: ["\"Hello\"", "\"Welcome\"", "\"Typing\""] },
            { id: 97, title: "Mixed Practice", words: ["A big car.", "The blue sky.", "Fast dogs."] },
            { id: 98, title: "Keys ( ) & @", words: ["(Hi)", "me@me", "Test()", "1@2"] },
            { id: 99, title: "The Master Run", words: ["Typing is a skill.", "Work hard daily.", "Win the game."] },
            { id: 100, title: "Speed Challenge", words: ["GO FAST", "STAY CALM", "TYPE WELL"] },
            { id: 101, title: "Graduation!", words: ["I can type now!", "Level 101 Complete.", "Victory!"] },
        ];

        let playerName = "Kh√°ch";
        let unlockedLevel = parseInt(localStorage.getItem('speedy_unlocked_level')) || 1;
        let currentLevel = null;
        let wordIndex = 0;
        let currentWords = [];
        let startTime = null;
        let totalErrors = 0;
        const TARGET_COUNT = 10;

        const nameScreen = document.getElementById('name-screen');
        const levelScreen = document.getElementById('level-screen');
        const gameContainer = document.getElementById('game-container');
        const levelGrid = document.getElementById('level-grid');
        const typingInput = document.getElementById('typing-input');
        const wordDisplay = document.getElementById('word-display');
        const playerCar = document.getElementById('player-car');
        const overlay = document.getElementById('message-overlay');

        const savedName = localStorage.getItem('speedy_last_name');
        if (savedName) document.getElementById('name-input').value = savedName;

        document.getElementById('confirm-name-btn').onclick = () => {
            const val = document.getElementById('name-input').value.trim();
            if (val) {
                playerName = val;
                document.getElementById('player-display-name').innerText = playerName;
                localStorage.setItem('speedy_last_name', playerName);
                nameScreen.classList.add('hidden');
                showLevels();
            }
        };

        function showLevels() {
            levelScreen.classList.remove('hidden');
            gameContainer.classList.add('hidden');
            overlay.classList.add('hidden');
            document.getElementById('unlocked-count').innerText = `Ti·∫øn ƒë·ªô: ${unlockedLevel}/${levels.length}`;
            renderLevelGrid();
        }

        function renderLevelGrid() {
            levelGrid.innerHTML = levels.map(lvl => {
                const isLocked = lvl.id > unlockedLevel;
                const isCompleted = lvl.id < unlockedLevel;
                let colorClass = isLocked ? 'bg-gray-800 border-gray-700 opacity-50' : 
                                 isCompleted ? 'bg-gray-800 border-emerald-400' : 'bg-gray-800 border-yellow-400';
                
                if (!isLocked) {
                    if (lvl.id >= 82) colorClass = isCompleted ? 'bg-gray-800 border-purple-400' : 'bg-gray-800 border-purple-300';
                    else if (lvl.id >= 52) colorClass = isCompleted ? 'bg-gray-800 border-blue-400' : 'bg-gray-800 border-blue-300';
                    else if (lvl.id >= 24) colorClass = isCompleted ? 'bg-gray-800 border-emerald-400' : 'bg-gray-800 border-emerald-300';
                }

                return `
                    <button onclick="${isLocked ? '' : `startLevel(${lvl.id})`}" 
                        class="p-4 rounded-xl border-2 transition-all text-left flex flex-col justify-between h-28 relative overflow-hidden
                        ${colorClass} ${!isLocked ? 'hover:scale-105' : 'cursor-not-allowed'}">
                        <span class="text-[10px] font-game ${isLocked ? 'text-gray-500' : 'text-emerald-400'}">B√†i ${lvl.id}</span>
                        <span class="text-xs font-bold leading-tight pr-4">${lvl.title}</span>
                        <span class="text-[10px] ${isLocked ? 'text-gray-500' : 'text-emerald-500 font-bold'}">
                            ${isLocked ? 'üîí KH√ìA' : isCompleted ? '‚úî XONG' : '‚ñ∂ H·ªåC'}
                        </span>
                    </button>
                `;
            }).join('');
        }

        function startLevel(id) {
            currentLevel = levels.find(l => l.id === id);
            wordIndex = 0;
            totalErrors = 0;
            currentWords = [];
            for(let i=0; i<TARGET_COUNT; i++) {
                currentWords.push(currentLevel.words[Math.floor(Math.random() * currentLevel.words.length)]);
            }

            document.getElementById('current-level-title').innerText = `Level ${currentLevel.id}: ${currentLevel.title}`;
            document.getElementById('progress-display').innerText = `0/${TARGET_COUNT}`;
            levelScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            typingInput.value = "";
            typingInput.disabled = false;
            typingInput.focus();
            
            playerCar.style.left = "0%";
            renderWord();
            startTime = Date.now();
        }

        function renderWord() {
            if (wordIndex >= TARGET_COUNT) { endGame(); return; }
            const target = currentWords[wordIndex];
            const typed = typingInput.value;
            let html = "";
            let isWrong = false;

            for (let i = 0; i < target.length; i++) {
                if (i < typed.length) {
                    if (typed[i] === target[i]) html += `<span class="text-emerald-400">${target[i]}</span>`;
                    else { html += `<span class="text-red-500 underline">${target[i]}</span>`; isWrong = true; }
                } else html += `<span class="text-gray-600">${target[i]}</span>`;
            }
            wordDisplay.innerHTML = html;

            if (isWrong) { playerCar.classList.add('shake'); totalErrors++; }
            else playerCar.classList.remove('shake');

            if (typed === target) {
                wordIndex++;
                typingInput.value = "";
                moveCar();
                renderWord();
            }
        }

        function moveCar() {
            const progress = (wordIndex / TARGET_COUNT) * 90;
            playerCar.style.left = `${progress}%`;
            playerCar.classList.add('jump');
            setTimeout(() => playerCar.classList.remove('jump'), 500);
            document.getElementById('progress-display').innerText = `${wordIndex}/${TARGET_COUNT}`;
            const elapsed = (Date.now() - startTime) / 60000;
            document.getElementById('wpm-display').innerText = Math.round(wordIndex / elapsed) || 0;
        }

        typingInput.addEventListener('input', renderWord);

        function endGame() {
            const timeElapsed = (Date.now() - startTime) / 60000;
            const finalWpm = Math.round(TARGET_COUNT / timeElapsed);
            const totalChars = currentWords.join('').length;
            const accuracy = Math.max(0, Math.round(((totalChars - totalErrors) / totalChars) * 100));

            typingInput.disabled = true;
            document.getElementById('final-wpm').innerText = finalWpm;
            document.getElementById('final-acc').innerText = accuracy;
            overlay.classList.remove('hidden');

            if (accuracy >= 80) {
                if (currentLevel.id === unlockedLevel && unlockedLevel < levels.length) {
                    unlockedLevel++;
                    localStorage.setItem('speedy_unlocked_level', unlockedLevel);
                }
                document.getElementById('status-title').innerText = "Th√†nh C√¥ng!";
                document.getElementById('status-icon').innerText = "üèÜ";
                document.getElementById('next-level-btn').classList.remove('hidden');
            } else {
                document.getElementById('status-title').innerText = "C·∫ßn C·ªë G·∫Øng!";
                document.getElementById('status-icon').innerText = "üîÑ";
                document.getElementById('next-level-btn').classList.add('hidden');
            }
        }

        document.getElementById('back-to-levels').onclick = showLevels;
        document.getElementById('level-menu-btn').onclick = showLevels;
        document.getElementById('next-level-btn').onclick = () => {
            if (currentLevel.id < levels.length) startLevel(currentLevel.id + 1);
            else showLevels();
        };

    </script>
</body>
</html>
